test "@test7.AutoGenerated::to_json works as expected on empty object" {
  let ag = @test7.AutoGenerated::new()
  let got = ag.to_json().stringify(escape_slash=false)
  let want =
    #|{}
  assert_eq!(got, want)
}

test "@json.parse(@test7.AutoGenerated) works as expected on empty object" {
  let jv = @json.parse!(
    #|{}
    ,
  )
  inspect!(
    jv,
    content=
      #|Object({})
    ,
  )
  let got : @test7.AutoGenerated = @json.from_json!(jv)
  let want = @test7.AutoGenerated::new()
  assert_eq!(got, want)
}

test "@json.parse(@test7.AutoGenerated) fails on bogus input" {
  let tests = [
    ("[]", "($, \"AutoGenerated::from_json: expected object\")"),
    (
      "{\"name\":1}", "($, \"AutoGenerated::from_json:name expected String or Null\")",
    ),
  ]
  for tt in tests {
    try {
      let jv = @json.parse!(tt.0)
      let _ : @test7.AutoGenerated = @json.from_json!(jv)
      raise Failure("expected error, but got none")
    } catch {
      @json.JsonDecodeError(e) => assert_eq!(e.to_string(), tt.1)
      e => raise e
    }
  }
}

test "@json.parse(@test7.AutoGenerated) works as expected on null inputs" {
  let jv = @json.parse!(
    #|{"name":null}
    ,
  )
  inspect!(
    jv,
    content=
      #|Object({"name": Null})
    ,
  )
  let got : @test7.AutoGenerated = @json.from_json!(jv)
  let want = @test7.AutoGenerated::new()
  assert_eq!(got, want)
}

test "@test7.AutoGenerated::to_json works as expected on populated object" {
  let got = ag.to_json().stringify(escape_slash=false)
  assert_eq!(got, want_ag)
}

test "@json.parse(@test7.AutoGenerated) works as expected on populated object" {
  let jv = @json.parse!(want_ag)
  let got : @test7.AutoGenerated = @json.from_json!(jv)
  assert_eq!(got, ag)
}

let ag : @test7.AutoGenerated = {
  id: Some(1296269),
  owner: Some(
    {
      login: Some("octocat"),
      id: Some(1),
      avatar_url: Some("https://github.com/images/error/octocat_happy.gif"),
      gravatar_id: Some("somehexcode"),
      url: Some("https://api.github.com/users/octocat"),
      html_url: Some("https://github.com/octocat"),
      followers_url: Some("https://api.github.com/users/octocat/followers"),
      following_url: Some(
        "https://api.github.com/users/octocat/following{/other_user}",
      ),
      gists_url: Some("https://api.github.com/users/octocat/gists{/gist_id}"),
      starred_url: Some(
        "https://api.github.com/users/octocat/starred{/owner}{/repo}",
      ),
      subscriptions_url: Some(
        "https://api.github.com/users/octocat/subscriptions",
      ),
      organizations_url: Some("https://api.github.com/users/octocat/orgs"),
      repos_url: Some("https://api.github.com/users/octocat/repos"),
      events_url: Some("https://api.github.com/users/octocat/events{/privacy}"),
      received_events_url: Some(
        "https://api.github.com/users/octocat/received_events",
      ),
      type_: None,
      site_admin: Some(false),
    },
  ),
  name: Some("Hello-World"),
  full_name: Some("octocat/Hello-World"),
  description: Some("This your first repo!"),
  private: Some(false),
  fork: Some(false),
  url: Some("https://api.github.com/repos/octocat/Hello-World"),
  html_url: Some("https://github.com/octocat/Hello-World"),
  clone_url: Some("https://github.com/octocat/Hello-World.git"),
  git_url: Some("git://github.com/octocat/Hello-World.git"),
  ssh_url: Some("git@github.com:octocat/Hello-World.git"),
  svn_url: Some("https://svn.github.com/octocat/Hello-World"),
  mirror_url: Some("git://git.example.com/octocat/Hello-World"),
  homepage: Some("https://github.com"),
  language: Some(Null),
  forks_count: Some(9),
  stargazers_count: Some(80),
  watchers_count: Some(80),
  size: Some(108),
  default_branch: Some("master"),
  open_issues_count: Some(0),
  has_issues: Some(true),
  has_wiki: Some(true),
  has_downloads: Some(true),
  pushed_at: Some("2011-01-26T19:06:43Z"),
  created_at: Some("2011-01-26T19:01:12Z"),
  updated_at: Some("2011-01-26T19:14:43Z"),
  permissions: Some({ admin: Some(false), push: Some(false), pull: Some(true) }),
  subscribers_count: Some(42),
  organization: Some(
    {
      login: Some("octocat"),
      id: Some(1),
      avatar_url: Some("https://github.com/images/error/octocat_happy.gif"),
      gravatar_id: Some("somehexcode"),
      url: Some("https://api.github.com/users/octocat"),
      html_url: Some("https://github.com/octocat"),
      followers_url: Some("https://api.github.com/users/octocat/followers"),
      following_url: Some(
        "https://api.github.com/users/octocat/following{/other_user}",
      ),
      gists_url: Some("https://api.github.com/users/octocat/gists{/gist_id}"),
      starred_url: Some(
        "https://api.github.com/users/octocat/starred{/owner}{/repo}",
      ),
      subscriptions_url: Some(
        "https://api.github.com/users/octocat/subscriptions",
      ),
      organizations_url: Some("https://api.github.com/users/octocat/orgs"),
      repos_url: Some("https://api.github.com/users/octocat/repos"),
      events_url: Some("https://api.github.com/users/octocat/events{/privacy}"),
      received_events_url: Some(
        "https://api.github.com/users/octocat/received_events",
      ),
      type_: None,
      site_admin: Some(false),
    },
  ),
  parent: Some(
    {
      id: Some(1296269),
      parent_owner: None,
      name: Some("Hello-World"),
      full_name: Some("octocat/Hello-World"),
      description: Some("This your first repo!"),
      private: Some(false),
      fork: Some(true),
      url: Some("https://api.github.com/repos/octocat/Hello-World"),
      html_url: Some("https://github.com/octocat/Hello-World"),
      clone_url: Some("https://github.com/octocat/Hello-World.git"),
      git_url: Some("git://github.com/octocat/Hello-World.git"),
      ssh_url: Some("git@github.com:octocat/Hello-World.git"),
      svn_url: Some("https://svn.github.com/octocat/Hello-World"),
      mirror_url: Some("git://git.example.com/octocat/Hello-World"),
      homepage: Some("https://github.com"),
      language: Some(Null),
      forks_count: Some(9),
      stargazers_count: Some(80),
      watchers_count: Some(80),
      size: Some(108),
      default_branch: Some("master"),
      open_issues_count: Some(0),
      has_issues: Some(true),
      has_wiki: Some(true),
      has_downloads: Some(true),
      pushed_at: Some("2011-01-26T19:06:43Z"),
      created_at: Some("2011-01-26T19:01:12Z"),
      updated_at: Some("2011-01-26T19:14:43Z"),
      parent_permissions: None,
    },
  ),
  source: Some(
    {
      id: Some(1296269),
      source_owner: None,
      name: Some("Hello-World"),
      full_name: Some("octocat/Hello-World"),
      description: Some("This your first repo!"),
      private: Some(false),
      fork: Some(true),
      url: Some("https://api.github.com/repos/octocat/Hello-World"),
      html_url: Some("https://github.com/octocat/Hello-World"),
      clone_url: Some("https://github.com/octocat/Hello-World.git"),
      git_url: Some("git://github.com/octocat/Hello-World.git"),
      ssh_url: Some("git@github.com:octocat/Hello-World.git"),
      svn_url: Some("https://svn.github.com/octocat/Hello-World"),
      mirror_url: Some("git://git.example.com/octocat/Hello-World"),
      homepage: Some("https://github.com"),
      language: Some(Null),
      forks_count: Some(9),
      stargazers_count: Some(80),
      watchers_count: Some(80),
      size: Some(108),
      default_branch: Some("master"),
      open_issues_count: Some(0),
      has_issues: Some(true),
      has_wiki: Some(true),
      has_downloads: Some(true),
      pushed_at: Some("2011-01-26T19:06:43Z"),
      created_at: Some("2011-01-26T19:01:12Z"),
      updated_at: Some("2011-01-26T19:14:43Z"),
      source_permissions: None,
    },
  ),
}

let want_ag =
  #|{"id":1296269,"owner":{"login":"octocat","id":1,"avatar_url":"https://github.com/images/error/octocat_happy.gif","gravatar_id":"somehexcode","url":"https://api.github.com/users/octocat","html_url":"https://github.com/octocat","followers_url":"https://api.github.com/users/octocat/followers","following_url":"https://api.github.com/users/octocat/following{/other_user}","gists_url":"https://api.github.com/users/octocat/gists{/gist_id}","starred_url":"https://api.github.com/users/octocat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/octocat/subscriptions","organizations_url":"https://api.github.com/users/octocat/orgs","repos_url":"https://api.github.com/users/octocat/repos","events_url":"https://api.github.com/users/octocat/events{/privacy}","received_events_url":"https://api.github.com/users/octocat/received_events","site_admin":false},"name":"Hello-World","full_name":"octocat/Hello-World","description":"This your first repo!","private":false,"fork":false,"url":"https://api.github.com/repos/octocat/Hello-World","html_url":"https://github.com/octocat/Hello-World","clone_url":"https://github.com/octocat/Hello-World.git","git_url":"git://github.com/octocat/Hello-World.git","ssh_url":"git@github.com:octocat/Hello-World.git","svn_url":"https://svn.github.com/octocat/Hello-World","mirror_url":"git://git.example.com/octocat/Hello-World","homepage":"https://github.com","language":null,"forks_count":9,"stargazers_count":80,"watchers_count":80,"size":108,"default_branch":"master","open_issues_count":0,"has_issues":true,"has_wiki":true,"has_downloads":true,"pushed_at":"2011-01-26T19:06:43Z","created_at":"2011-01-26T19:01:12Z","updated_at":"2011-01-26T19:14:43Z","permissions":{"admin":false,"push":false,"pull":true},"subscribers_count":42,"organization":{"login":"octocat","id":1,"avatar_url":"https://github.com/images/error/octocat_happy.gif","gravatar_id":"somehexcode","url":"https://api.github.com/users/octocat","html_url":"https://github.com/octocat","followers_url":"https://api.github.com/users/octocat/followers","following_url":"https://api.github.com/users/octocat/following{/other_user}","gists_url":"https://api.github.com/users/octocat/gists{/gist_id}","starred_url":"https://api.github.com/users/octocat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/octocat/subscriptions","organizations_url":"https://api.github.com/users/octocat/orgs","repos_url":"https://api.github.com/users/octocat/repos","events_url":"https://api.github.com/users/octocat/events{/privacy}","received_events_url":"https://api.github.com/users/octocat/received_events","site_admin":false},"parent":{"id":1296269,"name":"Hello-World","full_name":"octocat/Hello-World","description":"This your first repo!","private":false,"fork":true,"url":"https://api.github.com/repos/octocat/Hello-World","html_url":"https://github.com/octocat/Hello-World","clone_url":"https://github.com/octocat/Hello-World.git","git_url":"git://github.com/octocat/Hello-World.git","ssh_url":"git@github.com:octocat/Hello-World.git","svn_url":"https://svn.github.com/octocat/Hello-World","mirror_url":"git://git.example.com/octocat/Hello-World","homepage":"https://github.com","language":null,"forks_count":9,"stargazers_count":80,"watchers_count":80,"size":108,"default_branch":"master","open_issues_count":0,"has_issues":true,"has_wiki":true,"has_downloads":true,"pushed_at":"2011-01-26T19:06:43Z","created_at":"2011-01-26T19:01:12Z","updated_at":"2011-01-26T19:14:43Z"},"source":{"id":1296269,"name":"Hello-World","full_name":"octocat/Hello-World","description":"This your first repo!","private":false,"fork":true,"url":"https://api.github.com/repos/octocat/Hello-World","html_url":"https://github.com/octocat/Hello-World","clone_url":"https://github.com/octocat/Hello-World.git","git_url":"git://github.com/octocat/Hello-World.git","ssh_url":"git@github.com:octocat/Hello-World.git","svn_url":"https://svn.github.com/octocat/Hello-World","mirror_url":"git://git.example.com/octocat/Hello-World","homepage":"https://github.com","language":null,"forks_count":9,"stargazers_count":80,"watchers_count":80,"size":108,"default_branch":"master","open_issues_count":0,"has_issues":true,"has_wiki":true,"has_downloads":true,"pushed_at":"2011-01-26T19:06:43Z","created_at":"2011-01-26T19:01:12Z","updated_at":"2011-01-26T19:14:43Z"}}
